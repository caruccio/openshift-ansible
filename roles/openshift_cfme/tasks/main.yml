---
- name: Ensure the CFME user exists
  oc_user:
    state: present
    username: "{{ openshift_cfme_user }}"

- name: Ensure the CFME namespace exists and the CFME user is the admin
  oc_project:
    state: present
    name: "{{ openshift_cfme_project }}"
    display_name: "{{ openshift_cfme_project_description }}"
    admin: "{{ openshift_cfme_user }}"

- name: Ensure the CFME namespace service account is privileged
  oc_adm_policy_user:
    namespace: "{{ openshift_cfme_project }}"
    user: "{{ openshift_cfme_user }}"
    resource_kind: scc
    resource_name: privileged
    state: present

- name: TODO - Create NFS exports for CFME PVs
  debug:
    msg: "Not doing anything yet, just a placeholder"

- name: TODO - Evaluate and create CFME PVs
  debug:
    msg: "Not doing anything yet, just a placeholder"

- name: Ensure bulk image import limit is tuned
  yedit:
    src: /etc/origin/master/master-config.yml
    key: 'imagePolicyConfig#maxImagesBulkImportedPerRepository'
    value: "{{ openshift_cfme_maxImagesBulkImportedPerRepository | int() }}"
    state: present
# TODO: Figure out how to link to the right handlers rather than
# duplicate more restart logic
#  notify: 'config change - restart master service'


# TODO: I think I need to use oc_obj in some way here to create the
# template files for the PVs
#
# The templates in the repository right now aren't actual j2
# templates. The !spec/nfs/server param needs to be set to the NFS
# server in your inventory before the templates are evaluated
- name: Ensure the CFME PV templates are created
  debug:
    msg: "Not doing anything yet, just a placeholder"
  # with_items: "{{ openshift_cfme_pv_templates }}"

- name: Ensure the CFME PV templates are processed
  debug:
    msg: "Not doing anything yet, just a placeholder"
  # oc_process:
  #   namespace: "{{ openshift_cfme_project }}"
  #   state: present
  #   create: True
  #   template_name: "{{ item }}"
  # with_item: "{{ openshift_cfme_pv_templates }}"
